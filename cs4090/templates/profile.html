
{% extends 'base/base.html' %} <!-- TODO Make this look a lot better lmao -->
{% load static %}

{% block title %}Event Dashboard{% endblock title %}

{% block breadcrumb %}
    <div>
        <h1><i class="fa fa-dashboard"></i> Dashboard</h1>
        <p>Event Dashboard</p>
    </div>
    <ul class="app-breadcrumb breadcrumb">
        <li class="breadcrumb-item"><i class="fa fa-home fa-lg"></i></li>
        <li class="breadcrumb-item"><a href="#">Dashboard</a></li>
    </ul>
{% endblock breadcrumb %}

{% block content %}  <!-- This is where you make edits for this web page, changes outside of this block will mess with the side formats that match the rest of the website -->
<h1>Profile Page</h1>

<br> <!-- Adds a newline for spacing -->
<span class="basic-font">Welcome {{first_name}} {{last_name}} to your profile</span>
<br> <!-- Adds a newline for spacing -->
<br> <!-- Adds a newline for spacing -->
<br> <!-- Adds a newline for spacing -->
<br> <!-- Adds a newline for spacing -->
<br> <!-- Adds a newline for spacing -->
<br> <!-- Adds a newline for spacing -->
<br> <!-- Adds a newline for spacing -->
<br> <!-- Adds a newline for spacing -->
<br> <!-- Adds a newline for spacing -->
<br> <!-- Adds a newline for spacing -->
<br> <!-- Adds a newline for spacing -->

<!-- Hide current API key until revealed -->
<div class="hidden-container">
    <span class="token-label">Current Canvas Access Token - ***************</span>
    <span class="hidden-text">{{ canvas_api_key|default:"API key not found" }}</span>
</div>
<br> <!-- Adds a newline for spacing -->


<style>
    /* Container for the hidden text */

        .token-label {
        font-size: 1.25em; /* You can adjust the size as needed */
    }
    .basic-font {
        font-size: 1.25em; /* You can adjust the size as needed */
    }

    .hidden-container {
        position: relative;
        display: inline-block;
        cursor: pointer;
    }

    /* The hidden text */
    .hidden-text {
        visibility: hidden;
        opacity: 0;
        transition: opacity 0.3s;
        position: absolute;
        top: 100%;  /* Adjust as needed */
        left: 0;
        background-color: #f9f9f9; /* Background color */
        padding: 5px;
        border-radius: 4px;
        color: #333; /* Text color */
    }

    /* Show the hidden text on hover */
    .hidden-container:hover .hidden-text {
        visibility: visible;
        opacity: 1;
    }
</style>


<!-- Update api section-->
    
    

    <form method="post">
        {% csrf_token %}
        
        <!-- Display the form field for the API key manually -->
        <div class="form-group">
            <!--<label for="id_api_key">New API Key</label>-->
            {{ form.api_key }}  <!-- Manually render the form field -->
        </div>

        <!-- Display errors for the API key field -->
        {% if form.api_key.errors %}
            <div class="alert alert-danger">
                <ul>
                    {% for error in form.api_key.errors %}
                        <li>{{ error }}</li>
                    {% endfor %}
                </ul>
            </div>
        {% endif %}

        {% if messages %}
        {% for message in messages %}
            <div class="alert {{ message.tags }}">{{ message }}</div>
        {% endfor %}
        {% endif %}

        <!-- Add buttons for importing and exporting -->
        <br>
        <br>
        <div class="col-md-12">
            <div class="form-group">
                <button id="import_event_button" type="button" class="btn btn-primary">Import Events from JSON</button>
            </div>
        </div>
        <br>
        <br>
        <div class="col-md-12">
            <div class="form-group">
                <button id="export_event_button" type="button" class="btn btn-primary">Export Events to JSON</button>
            </div>
        </div>
    </form>

    <!-- Add script listeners for each button--> 
    <script>
        // Import event
        document.getElementById('import_event_button').addEventListener('click', function() {
            fetch('/import-events/', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                // Handle the response data and export it as a JSON file
                const exportData = JSON.stringify(data, null, 2);  
                
                // Create a Blob from the JSON data
                const blob = new Blob([exportData], { type: 'application/json' });
                
                // Create a download link
                const exportLink = document.createElement('a');
                exportLink.href = URL.createObjectURL(blob);
                exportLink.download = 'export.json'; 
                
                // Click the link automatically
                exportLink.click();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('There was an error importing the events.');
            });
        });

        // Export event
        document.getElementById('export_event_button').addEventListener('click', function() {
            fetch('/export-events/', {
                method: 'GET', 
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                // Handle the response data and export it as a JSON file
                const exportData = JSON.stringify(data, null, 2);  
                
                // Create a Blob from the JSON data
                const blob = new Blob([exportData], { type: 'application/json' });
                
                // Create a download link
                const exportLink = document.createElement('a');
                exportLink.href = URL.createObjectURL(blob);
                exportLink.download = 'export.json'; 
                
                // Click the link automatically
                exportLink.click();
            })
            .catch(error => {
                console.error('Error:', error);
                alert('There was an error exporting the events.');
            });
        });
    </script>
    
{% endblock content %}

{% block extrascripts %}
    <script type="text/javascript" src="{% static 'js/plugins/jquery.dataTables.min.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/plugins/dataTables.bootstrap.min.js' %}"></script>
    <script type="text/javascript">$('#sampleTable').DataTable();</script>
{% endblock extrascripts %}